commit 107a9b2ba6c4a8465e10f4c24bab5f18fd5b84a0
Author: Pootle Translation <pootle@dev.laptop.org>
Date:   Mon Dec 15 07:08:43 2008 -0500

    Update Urdu translations

diff --git a/po/ur.po b/po/ur.po
index 12cb344..627f7a8 100644
--- a/po/ur.po
+++ b/po/ur.po
@@ -11,9 +11,9 @@ msgstr ""
 "Last-Translator: salman minhas <sulmanminhas@gmail.com>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
 "MIME-Version: 1.0\n"
-"Plural-Forms: nplurals=2; plural=(n!=1);\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
+"Plural-Forms: nplurals=2; plural=(n!=1);\n"
 "X-Generator: Pootle 1.1.0rc2\n"
 
 #: ../src/sugar/activity/activity.py:120

commit 856c84b523aaeafdda80e7969636ebd9fe029dff
Author: Pootle Translation <pootle@dev.laptop.org>
Date:   Mon Nov 17 10:09:23 2008 -0500

    Fixed misformed plural equation

diff --git a/po/ru.po b/po/ru.po
index 91c2300..c86e0fb 100644
--- a/po/ru.po
+++ b/po/ru.po
@@ -2,153 +2,160 @@
 # Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
 # This file is distributed under the same license as the PACKAGE package.
 # FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
-#, fuzzy
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2008-06-24 00:07+0530\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
-"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
+"PO-Revision-Date: 2008-09-08 11:53-0400\n"
+"Last-Translator: Kirill Krinkin <homebox@pisem.net>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
 "MIME-Version: 1.0\n"
-"Plural-Forms: 	 nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%10< =4 && (n%100<10 or n%100>=20) ? 1 : 2);\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"X-Generator: Translate Toolkit 1.1.1rc4\n"
+"Plural-Forms: nplurals=3; plural=(n%10==1 && n%100!=11 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2);\n"
+"X-Generator: Pootle 1.1.0rc2\n"
 
 #: ../src/sugar/activity/activity.py:120
 msgid "Share with:"
-msgstr ""
+msgstr "Использовать совместно с:"
 
 #: ../src/sugar/activity/activity.py:122
 msgid "Private"
-msgstr ""
+msgstr "Персонально"
 
 #: ../src/sugar/activity/activity.py:123
 msgid "My Neighborhood"
-msgstr ""
+msgstr "Мои соседи"
 
 #: ../src/sugar/activity/activity.py:130
 msgid "Keep"
-msgstr ""
+msgstr "Хранить"
 
 #: ../src/sugar/activity/activity.py:136
 msgid "Stop"
-msgstr ""
+msgstr "Стоп"
 
 #: ../src/sugar/activity/activity.py:251
 msgid "Undo"
-msgstr ""
+msgstr "Откат"
 
 #: ../src/sugar/activity/activity.py:256
 msgid "Redo"
-msgstr ""
+msgstr "Повтор"
 
 #: ../src/sugar/activity/activity.py:266
 msgid "Copy"
-msgstr ""
+msgstr "Копировать"
 
 #: ../src/sugar/activity/activity.py:271
 msgid "Paste"
-msgstr ""
+msgstr "Вставить"
 
 #: ../src/sugar/activity/activity.py:297
 msgid "Activity"
-msgstr ""
+msgstr "Активность"
 
 #: ../src/sugar/activity/activity.py:469
 #, python-format
 msgid "%s Activity"
-msgstr ""
+msgstr "Активность %s"
 
 #: ../src/sugar/activity/activity.py:856
 msgid "Keep error"
-msgstr ""
+msgstr "Ошибка хранения"
 
 #: ../src/sugar/activity/activity.py:857
 msgid "Keep error: all changes will be lost"
-msgstr ""
+msgstr "Ошибка хранения: все изменения будут потеряны"
 
 #: ../src/sugar/activity/activity.py:860
 msgid "Don't stop"
-msgstr ""
+msgstr "Не останавливаться"
 
 #: ../src/sugar/activity/activity.py:863
 msgid "Stop anyway"
-msgstr ""
+msgstr "Остановить в любом случае"
 
 #: ../src/sugar/graphics/alert.py:166 ../src/sugar/graphics/alert.py:209
 msgid "Cancel"
-msgstr ""
+msgstr "Отмена"
 
 #: ../src/sugar/graphics/alert.py:170 ../src/sugar/graphics/alert.py:247
 msgid "Ok"
-msgstr ""
+msgstr "Ok"
 
 #: ../src/sugar/graphics/alert.py:219
 msgid "Continue"
-msgstr ""
+msgstr "Продолжить"
 
+# требует проверки! что там в исходном коде?
 #: ../src/sugar/util.py:181
 msgid " and "
-msgstr ""
+msgstr "_and_"
 
+# требует проверки! что там в исходном коде?
 #: ../src/sugar/util.py:182
 msgid ", "
-msgstr ""
+msgstr ",_"
 
 #. TRANS: Indicating something that just happened, eg. "just now", "moments ago"
 #: ../src/sugar/util.py:185
 msgid "Seconds ago"
-msgstr ""
+msgstr "Секунд назад"
 
 #. TRANS: Indicating time passed, eg. "[10 day, 5 hours] ago",
 #. "[2 minutes] in the past", or "[3 years, 1 month] earlier"
 #: ../src/sugar/util.py:189
 #, python-format
 msgid "%s ago"
-msgstr ""
+msgstr "%s назад"
 
 #. TRANS: Relative dates (eg. 1 month and 5 days).
 #: ../src/sugar/util.py:202
 #, python-format
 msgid "%d year"
 msgid_plural "%d years"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d год"
+msgstr[1] "%d года"
+msgstr[2] "%d лет"
 
 #: ../src/sugar/util.py:203
 #, python-format
 msgid "%d month"
 msgid_plural "%d months"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d месяц"
+msgstr[1] "%d месяца"
+msgstr[2] "%d месяцев"
 
 #: ../src/sugar/util.py:204
 #, python-format
 msgid "%d week"
 msgid_plural "%d weeks"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d неделя"
+msgstr[1] "%d недели"
+msgstr[2] "%d недель"
 
 #: ../src/sugar/util.py:205
 #, python-format
 msgid "%d day"
 msgid_plural "%d days"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d день"
+msgstr[1] "%d дня"
+msgstr[2] "%d дней"
 
 #: ../src/sugar/util.py:206
 #, python-format
 msgid "%d hour"
 msgid_plural "%d hours"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d час"
+msgstr[1] "%d часа"
+msgstr[2] "%d часов"
 
 #: ../src/sugar/util.py:207
 #, python-format
 msgid "%d minute"
 msgid_plural "%d minutes"
-msgstr[0] ""
-msgstr[1] ""
+msgstr[0] "%d минута"
+msgstr[1] "%d минуты"
+msgstr[2] "%d минут"

commit 9e852bbbbd95baba541390faba3d08cafd09df95
Author: Pootle Translation <pootle@dev.laptop.org>
Date:   Tue Oct 7 11:23:27 2008 -0400

    Commit from One Laptop Per Child: Translation System by user rangertr. 28 of 28 messages translated (0 fuzzy).

diff --git a/po/tr.po b/po/tr.po
index 377a939..0d32a1c 100644
--- a/po/tr.po
+++ b/po/tr.po
@@ -7,91 +7,91 @@ msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
 "Report-Msgid-Bugs-To: \n"
 "POT-Creation-Date: 2008-06-24 00:07+0530\n"
-"PO-Revision-Date: 2008-08-28 07:53-0400\n"
+"PO-Revision-Date: 2008-09-26 06:43-0400\n"
 "Last-Translator: abdullah kocabas <abdullah.kocabas@abcdizustu.com>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=2; plural=(n!=1);\n"
+"Plural-Forms: nplurals=2; plural=(n != 1);\n"
 "X-Generator: Pootle 1.1.0rc2\n"
 
 #: ../src/sugar/activity/activity.py:120
 msgid "Share with:"
-msgstr "paylaşınız."
+msgstr "Paylaş"
 
 #: ../src/sugar/activity/activity.py:122
 msgid "Private"
-msgstr "özel"
+msgstr "Özel"
 
 #: ../src/sugar/activity/activity.py:123
 msgid "My Neighborhood"
-msgstr "komşularım"
+msgstr "Komşularım"
 
 #: ../src/sugar/activity/activity.py:130
 msgid "Keep"
-msgstr "kaydediniz."
+msgstr "Kaydet"
 
 #: ../src/sugar/activity/activity.py:136
 msgid "Stop"
-msgstr "durdurunuz."
+msgstr "Durdur"
 
 #: ../src/sugar/activity/activity.py:251
 msgid "Undo"
-msgstr "geri alınız."
+msgstr "Geri al"
 
 #: ../src/sugar/activity/activity.py:256
 msgid "Redo"
-msgstr "yeniden yapınız."
+msgstr "Yeniden yap"
 
 #: ../src/sugar/activity/activity.py:266
 msgid "Copy"
-msgstr "kopyalayınız."
+msgstr "Kopyala"
 
 #: ../src/sugar/activity/activity.py:271
 msgid "Paste"
-msgstr "yapıştırınız."
+msgstr "Yapıştır"
 
 #: ../src/sugar/activity/activity.py:297
 msgid "Activity"
-msgstr "etkinlik"
+msgstr "Aktivite"
 
 #: ../src/sugar/activity/activity.py:469
 #, python-format
 msgid "%s Activity"
-msgstr "%s etkinlik"
+msgstr "%s Aktivite"
 
 #: ../src/sugar/activity/activity.py:856
 msgid "Keep error"
-msgstr "hatayı saklayınız."
+msgstr "Kayıt hatası"
 
 #: ../src/sugar/activity/activity.py:857
 msgid "Keep error: all changes will be lost"
-msgstr "hata devam ediyor, tüm değişiklikleriniz silinecektir."
+msgstr "Kayıt hatası: tüm değişiklikleriniz kaybolacaktır"
 
 #: ../src/sugar/activity/activity.py:860
 msgid "Don't stop"
-msgstr "durmayınız."
+msgstr "Durma"
 
 #: ../src/sugar/activity/activity.py:863
 msgid "Stop anyway"
-msgstr "mutlaka durunuz."
+msgstr "Dur"
 
 #: ../src/sugar/graphics/alert.py:166 ../src/sugar/graphics/alert.py:209
 msgid "Cancel"
-msgstr "iptal ediniz."
+msgstr "İptal "
 
 #: ../src/sugar/graphics/alert.py:170 ../src/sugar/graphics/alert.py:247
 msgid "Ok"
-msgstr "tamam"
+msgstr "Tamam"
 
 #: ../src/sugar/graphics/alert.py:219
 msgid "Continue"
-msgstr "devam ediniz."
+msgstr "Devam et"
 
 #: ../src/sugar/util.py:181
 msgid " and "
-msgstr "ve"
+msgstr "Ve"
 
 #: ../src/sugar/util.py:182
 msgid ", "
@@ -100,14 +100,14 @@ msgstr ",_"
 #. TRANS: Indicating something that just happened, eg. "just now", "moments ago"
 #: ../src/sugar/util.py:185
 msgid "Seconds ago"
-msgstr "saniye önce"
+msgstr "Saniye önce"
 
 #. TRANS: Indicating time passed, eg. "[10 day, 5 hours] ago",
 #. "[2 minutes] in the past", or "[3 years, 1 month] earlier"
 #: ../src/sugar/util.py:189
 #, python-format
 msgid "%s ago"
-msgstr "%s önce"
+msgstr "%s Önce"
 
 #. TRANS: Relative dates (eg. 1 month and 5 days).
 #: ../src/sugar/util.py:202
@@ -151,4 +151,3 @@ msgid "%d minute"
 msgid_plural "%d minutes"
 msgstr[0] "%d dakika"
 msgstr[1] "%d dakikalar"
-

commit 2a10f318e393ba97cb2341bbde0015b7483fbc6d
Author: C. Scott Ananian <cscott@laptop.org>
Date:   Fri Sep 26 00:47:35 2008 -0400

    Trac #8674: sanity-check bundle root; don't delete install_root on failure.
    
    The software updater was deleting ~/Activities when it encountered a bad
    bundle.  Two separate issues:  we didn't sanity check the bundle root to
    ensure it wasn't '.' or '..' or something crazy like that, and our "clean
    up on failure" code was deleting the install_root instead of the activity
    root (!).  This was a regression introduced by the fix for #7733 in
    commit db2d1c42e2481d6dbc15405840ac23e46eab7318 (0.82.2).

diff --git a/src/sugar/bundle/bundle.py b/src/sugar/bundle/bundle.py
index 0319b9e..e9bd9f8 100644
--- a/src/sugar/bundle/bundle.py
+++ b/src/sugar/bundle/bundle.py
@@ -86,6 +86,9 @@ class Bundle:
             del file_names[0]
 
         self._zip_root_dir = file_names[0].split('/')[0]
+        if self._zip_root_dir.startswith('.'):
+            raise MalformedBundleException(
+                'root directory starts with .')
         if self._unzipped_extension is not None:
             (name_, ext) = os.path.splitext(self._zip_root_dir)
             if ext != self._unzipped_extension:
@@ -162,7 +165,8 @@ class Bundle:
         if os.spawnlp(os.P_WAIT, 'unzip', 'unzip', '-o', self._path,
                       '-x', 'mimetype', '-d', install_dir):
             # clean up install dir after failure
-            shutil.rmtree(install_dir, ignore_errors=True)
+            shutil.rmtree(os.path.join(install_dir, self._zip_root_dir),
+                          ignore_errors=True)
             # indicate failure.
             raise ZipExtractException
 

commit ffc40970bc4f106446194863772935627a8a9b91
Author: Tomeu Vizoso <tomeu@tomeuvizoso.net>
Date:   Thu Sep 25 20:19:05 2008 +0200

    Set the correct locale path for system activities

diff --git a/src/sugar/activity/activityfactory.py b/src/sugar/activity/activityfactory.py
index 90f55cd..02caa84 100644
--- a/src/sugar/activity/activityfactory.py
+++ b/src/sugar/activity/activityfactory.py
@@ -116,6 +116,9 @@ def get_environment(activity):
     environ['PATH'] = bin_path + ':' + environ['PATH']
     #environ['RAINBOW_STRACE_LOG'] = '1'
 
+    if activity.path.startswith(env.get_user_activities_path()):
+        environ['SUGAR_LOCALEDIR'] = os.path.join(activity.path, 'locale')
+
     if activity.bundle_id in [ 'org.laptop.WebActivity', 
                                'org.laptop.GmailActivity',
                                'org.laptop.WikiBrowseActivity'
diff --git a/src/sugar/activity/main.py b/src/sugar/activity/main.py
index 2175ff3..6ece927 100644
--- a/src/sugar/activity/main.py
+++ b/src/sugar/activity/main.py
@@ -89,8 +89,11 @@ def main():
 
     gtk.icon_theme_get_default().append_search_path(bundle.get_icons_path())
 
-    gettext.bindtextdomain(bundle.get_bundle_id(),
-                           bundle.get_locale_path())
+    locale_path = None
+    if 'SUGAR_LOCALEDIR' in os.environ:
+        locale_path = os.environ['SUGAR_LOCALEDIR']
+
+    gettext.bindtextdomain(bundle.get_bundle_id(), locale_path)
     gettext.textdomain(bundle.get_bundle_id())
 
     splitted_module = args[0].rsplit('.', 1)
